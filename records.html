<<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COESC | Receipt Vault</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #003366; --bg: #f4f4f9; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .vault-container { max-width: 1300px; margin: auto; background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        .header-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 20px; }
        h1 { color: var(--primary); margin: 0; font-size: 24px; }

        .btn-back { background: #fff; color: #333; border: 1px solid #ccc; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: 600; }
        .btn-refresh { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600; margin-bottom: 20px; }

        /* Table Styling */
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; white-space: nowrap; }
        th { background: var(--primary); color: white; padding: 12px 8px; text-align: left; text-transform: uppercase; }
        td { padding: 10px 8px; border-bottom: 1px solid #ddd; }
        tr:hover { background: #f9f9f9; }
        
        .bal-red { color: red; font-weight: bold; }
        .bal-green { color: green; font-weight: bold; }
    </style>
</head>
<body>

<div class="vault-container">
    <div class="header-row">
        <h1>üìÇ Official Receipt Vault (2026)</h1>
        <button class="btn-back" onclick="window.location.href='index.html'">‚Üê Back to Encoder</button>
    </div>

    <button class="btn-refresh" onclick="fetchRecords()">üîÑ Refresh List</button>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Code (A)</th>
                    <th>Date (B)</th>
                    <th>From (C)</th>
                    <th>Amount (D)</th>
                    <th>Words (E)</th>
                    <th>Description (F)</th>
                    <th>By (G)</th>
                    <th>Order No (H)</th>
                    <th>Item (I)</th>
                    <th>Mode (J)</th>
                    <th>Balance (K)</th>
                </tr>
            </thead>
            <tbody id="vault-body">
                <tr><td colspan="11" style="text-align:center; padding: 30px;">Loading data from Google Sheets...</td></tr>
            </tbody>
        </table>
    </div>
</div>


<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby_E5rdVdJIyjxgvzo_cKd2BN8o_sCpg-R4xOxFpT0Fzfk-MPyLX-FkR1wm3KDv5d_o/exec';

    function fetchRecords() {
        const body = document.getElementById('vault-body');
        body.innerHTML = "<tr><td colspan='10' style='text-align:center;'>Fetching from Cloud...</td></tr>";

        fetch(SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                body.innerHTML = "";
                if (data.length === 0) {
                    body.innerHTML = "<tr><td colspan='10' style='text-align:center;'>No records found.</td></tr>";
                    return;
                }

                data.reverse().forEach(rec => {
                    const balance = parseFloat(rec.balance || 0);
    const row = `<tr>
        <td><strong>${rec.receiptCode}</strong></td>
        <td>${rec.date}</td>
        <td>${rec.receivedFrom}</td>
        <td>‚Ç±${parseFloat(rec.amountInNumber).toLocaleString()}</td>
        <td>${rec.amountInWords}</td>
        <td>${rec.description}</td>
        <td>${rec.receivedBy}</td>
        <td>${rec.orderNumber}</td>
        <td>${rec.merch}</td>
        <td>${rec.modeOfPayment}</td>
        <td class="${balance > 0 ? 'bal-red' : 'bal-green'}">‚Ç±${balance.toFixed(2)}</td>
        <td>
            <div class="action-btns">
                <button class="btn-edit" onclick='loadToEncoder(${JSON.stringify(rec)})'>Load/Edit</button>
                <button class="btn-del" onclick="deleteRecord('${rec.receiptCode}')">Delete</button>
            </div>
        </td>
    </tr>`;
    body.innerHTML += row;
                });
            })
            .catch(err => {
                body.innerHTML = "<tr><td colspan='10' style='color:red; text-align:center;'>Error connecting to Google Sheets.</td></tr>";
            });
    }
// 1. Load data back to Encoder for Printing/Editing
function loadToEncoder(record) {
    // Save this specific record as the "Active Edit"
    localStorage.setItem('edit_record', JSON.stringify(record));
    // Redirect back to the encoder
    window.location.href = 'index.html';
}

// 2. Delete Record from Google Sheets
async function deleteRecord(code) {
    if (!confirm(`Are you sure you want to delete ${code}? This cannot be undone.`)) return;

    // We send a POST request with an action: 'DELETE'
    try {
        await fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify({ action: 'DELETE', receiptCode: code })
        });
        alert("Delete request sent! Please refresh in a moment.");
        fetchRecords(); // Refresh the list
    } catch (e) {
        alert("Error deleting: " + e.message);
    }
}
    // Auto-load on open
    window.onload = fetchRecords;
</script>
</body>
</html>
